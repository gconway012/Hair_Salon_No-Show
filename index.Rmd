---
title: "Hair Salon No-Show Project"
author: "G. Conway"
knit: (function(inputFile, encoding) {
      out_dir <- 'docs';
      rmarkdown::render(inputFile,
                        encoding=encoding,
                        output_file=file.path(dirname(inputFile), out_dir, 'index.html')) })
output:
  flexdashboard::flex_dashboard:
    orientation: column
    vertical_layout: scroll
    theme: cerulean
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE)
```

```{r setwd}
setwd("~/Documents/GitHub/Hair_Salon_No-Show/")
```

```{r packages, message=FALSE}
# check if package is installed and then load package for use
if (!require("tidyverse")){
  install.packages("tidyverse", 
                   repos = "https://cran.rstudio.com/",
                   quiet = T)
  require("tidyverse")
}

if (!require("kableExtra")){
  install.packages("kableExtra", 
                   repos = "https://cran.rstudio.com/",
                   quiet = T)
  require("kableExtra")
}
```

```{r data_file_names}
# local data files stored in the below datafolder for mysql server to access
datafolder <- "/usr/local/mysql-8.0.19-macos10.15-x86_64/mylocaldata/"
datafilenames <- dir("/usr/local/mysql-8.0.19-macos10.15-x86_64/mylocaldata/",
                     pattern = ".csv")
datafilepaths <- paste(datafolder, datafilenames, sep = "")
```

Welcome
===============================================================================




About {data-navmenu="Pre-DB Explore"}
===============================================================================

### About Pre-DB Exploration

* The information contained on each page under the **Pre-DB Explore** tab was used to design the tables used in a MySQL database.

<br>

* This information helped to identify what tables to create, their respective keys and how each table would be linked.

Client Cancellations {data-navmenu="Pre-DB Explore"}
===============================================================================

```{r read_client_cancel}
cc <- read_csv(datafilepaths[1])
```

Column
-------------------------------------------------------------------------------

### data file

**Client Cancellations**

### data dimensions
```{r cc_dim, fig.height=2}
dim(cc)
```

### data sample
```{r cc_head}
head(cc, 5) %>%
    kable(format = "html", escape = F) %>%
    kable_styling(bootstrap_options = "striped", full_width = F, 
                  position = "left")
```

### column classes/data types
```{r cc_col_classes}
as.data.frame(sapply(cc, class), stringsAsFactors = F) %>%
    rownames_to_column() %>%
    mutate(class_type = `sapply(cc, class)`) %>%
    column_to_rownames(var = "rowname") %>%
    select(class_type) %>%
    kable(format = "html", escape = F) %>%
    kable_styling(bootstrap_options = "striped", full_width = F, 
                  position = "left")
```

### max column width (in characters)
```{r cc_max_col_width}
as.data.frame(sapply(cc, function(x){max(nchar(x, keepNA = F))})) %>%
    rownames_to_column() %>%
    mutate(max_num_char = `sapply(cc, function(x) {     max(nchar(x, keepNA = F)) })`) %>%
    column_to_rownames(var = "rowname") %>%
    select(max_num_char) %>%
    kable(format = "html", escape = F) %>%
    kable_styling(bootstrap_options = "striped", full_width = F, 
                  position = "left")
```

### missing/null values index number
```{r cc_missing}
sapply(cc, function(x){which(is.na(x))})
```

Column
-------------------------------------------------------------------------------
### unique Code values
```{r unique_Code_cc}
unlist(lapply(cc, function(x){sort(unique(x), decreasing = F, na.last = T)})[[2]])
```

### unique Service values
```{r unique_Service_cc}
unlist(lapply(cc, function(x){sort(unique(x), decreasing = F, na.last = T)})[[3]])
```

### unique Staff values
```{r unique_Staff_cc}
unlist(lapply(cc, function(x){sort(unique(x), decreasing = F, na.last = T)})[[4]])
```

### unique Cancelled By values
```{r unique_CanceledBy_cc}
unlist(lapply(cc, function(x){sort(unique(x), decreasing = F, na.last = T)})[[6]])
```

```{r}
rm(cc)
```

Future Bookings {data-navmenu="Pre-DB Explore"}
===============================================================================

```{r read_future_bookings}
fb <- read_csv(datafilepaths[2],
               col_types = cols(Code = col_character(),
                             Staff = col_character(),
                             Service = col_character(),
                             Date = col_character(),
                             Time = col_character(),
                             TimeInt = col_double())
               )
```

Column
-------------------------------------------------------------------------------

### data file

**Future Bookings**

### data dimensions
```{r fb_dim, fig.height=2}
dim(fb)
```

### data sample
```{r fb_head}
head(fb, 5) %>%
    kable(format = "html", escape = F) %>%
    kable_styling(bootstrap_options = "striped", full_width = F, 
                  position = "left")
```

### column classes/data types
```{r fb_col_classes}
as.data.frame(sapply(fb, class), stringsAsFactors = F) %>%
    rownames_to_column() %>%
    mutate(class_type = `sapply(fb, class)`) %>%
    column_to_rownames(var = "rowname") %>%
    select(class_type) %>%
    kable(format = "html", escape = F) %>%
    kable_styling(bootstrap_options = "striped", full_width = F, 
                  position = "left")
```

### max column width (in characters)
```{r fb_max_col_width}
as.data.frame(sapply(fb, function(x){max(nchar(x, keepNA = F))})) %>%
    rownames_to_column() %>%
    mutate(max_num_char = `sapply(fb, function(x) {     max(nchar(x, keepNA = F)) })`) %>%
    column_to_rownames(var = "rowname") %>%
    select(max_num_char) %>%
    kable(format = "html", escape = F) %>%
    kable_styling(bootstrap_options = "striped", full_width = F, 
                  position = "left")
```

### missing/null values index number
```{r fb_missing, fig.height=8.5}
sapply(fb, function(x){which(is.na(x))})
```

Column
-------------------------------------------------------------------------------
### unique Code values
```{r unique_Code_fb, fig.height=8}
unlist(lapply(fb, function(x){sort(unique(x), decreasing = F, na.last = T)})[[1]])
```

### unique Staff values
```{r unique_Description_fb, fig.height=2}
unlist(lapply(fb, function(x){sort(unique(x), decreasing = F, na.last = T)})[[2]])
```

### unique Service values
```{r unique_Service_fb, fig.height=2}
unlist(lapply(fb, function(x){sort(unique(x), decreasing = F, na.last = T)})[[3]])
```

```{r}
rm(fb)
```

No_Show Report {data-navmenu="Pre-DB Explore"}
===============================================================================

```{r read_no_show}
ns <- read_csv(datafilepaths[3])
```

Column
-------------------------------------------------------------------------------

### data file

**No_Show Report**

### data dimensions
```{r ns_dim, fig.height=2}
dim(ns)
```

### data sample
```{r ns_head}
head(ns, 5) %>%
    kable(format = "html", escape = F) %>%
    kable_styling(bootstrap_options = "striped", full_width = F, 
                  position = "left")
```

### column classes/data types
```{r ns_col_classes}
as.data.frame(sapply(ns, class), stringsAsFactors = F) %>%
    rownames_to_column() %>%
    mutate(class_type = `sapply(ns, class)`) %>%
    column_to_rownames(var = "rowname") %>%
    select(class_type) %>%
    kable(format = "html", escape = F) %>%
    kable_styling(bootstrap_options = "striped", full_width = F, 
                  position = "left")
```

### max column width (in characters)
```{r ns_max_col_width}
as.data.frame(sapply(ns, function(x){max(nchar(x, keepNA = F))})) %>%
    rownames_to_column() %>%
    mutate(max_num_char = `sapply(ns, function(x) {     max(nchar(x, keepNA = F)) })`) %>%
    column_to_rownames(var = "rowname") %>%
    select(max_num_char) %>%
    kable(format = "html", escape = F) %>%
    kable_styling(bootstrap_options = "striped", full_width = F, 
                  position = "left")
```

### missing/null values index number
```{r ns_missing}
sapply(ns, function(x){which(is.na(x))})
```

Column
-------------------------------------------------------------------------------
### unique Code values
```{r unique_Code_ns}
unlist(lapply(ns, function(x){sort(unique(x), decreasing = F, na.last = T)})[[2]])
```

### unique Service values
```{r unique_Description_ns}
unlist(lapply(ns, function(x){sort(unique(x), decreasing = F, na.last = T)})[[3]])
```

### unique Staff values
```{r unique_Category_ns}
unlist(lapply(ns, function(x){sort(unique(x), decreasing = F, na.last = T)})[[4]])
```

```{r}
rm(ns)
```

Product Listing-Retail {data-navmenu="Pre-DB Explore"}
===============================================================================

```{r read_product_listing_retail}
plr <- read_csv(datafilepaths[4])
```

Column
-------------------------------------------------------------------------------

### data file

**Product Listing-Retail**

### data dimensions
```{r plr_dim, fig.height=2}
dim(plr)
```

### data sample
```{r plr_head}
head(plr, 5) %>%
    kable(format = "html", escape = F) %>%
    kable_styling(bootstrap_options = "striped", full_width = F, 
                  position = "left")
```

### column classes/data types
```{r plr_col_classes}
as.data.frame(sapply(plr, class), stringsAsFactors = F) %>%
    rownames_to_column() %>%
    mutate(class_type = `sapply(plr, class)`) %>%
    column_to_rownames(var = "rowname") %>%
    select(class_type) %>%
    kable(format = "html", escape = F) %>%
    kable_styling(bootstrap_options = "striped", full_width = F, 
                  position = "left")
```

### max column width (in characters)
```{r plr_max_col_width}
as.data.frame(sapply(plr, function(x){max(nchar(x, keepNA = F))})) %>%
    rownames_to_column() %>%
    mutate(max_num_char = `sapply(plr, function(x) {     max(nchar(x, keepNA = F)) })`) %>%
    column_to_rownames(var = "rowname") %>%
    select(max_num_char) %>%
    kable(format = "html", escape = F) %>%
    kable_styling(bootstrap_options = "striped", full_width = F, 
                  position = "left")
```

### missing/null values index number
```{r plr_missing, fig.height=8.5}
sapply(plr, function(x){which(is.na(x))})
```

Column
-------------------------------------------------------------------------------
### unique Code values
```{r unique_Code_plr, fig.height=4.5}
unlist(lapply(plr, function(x){sort(unique(x), decreasing = F, na.last = T)})[[2]])
```

### unique Description values
```{r unique_Description_plr, fig.height=8}
unlist(lapply(plr, function(x){sort(unique(x), decreasing = F, na.last = T)})[[3]])
```

### unique Supplier values
```{r unique_Supplier_plr, fig.height=2}
unlist(lapply(plr, function(x){sort(unique(x), decreasing = F, na.last = T)})[[4]])
```

### unique Brand values
```{r unique_Brand_plr, fig.height=2}
unlist(lapply(plr, function(x){sort(unique(x), decreasing = F, na.last = T)})[[5]])
```

### unique Category values
```{r unique_Category_plr, fig.height=2}
unlist(lapply(plr, function(x){sort(unique(x), decreasing = F, na.last = T)})[[6]])
```

```{r}
rm(plr)
```

Receipt Transactions {data-navmenu="Pre-DB Explore"}
===============================================================================

```{r read_receipt_trans}
rt <- read_csv(datafilepaths[5])
```

Column
-------------------------------------------------------------------------------

### data file

**Receipt Transactions**

### data dimensions
```{r rt_dim, fig.height=2}
dim(rt)
```

### data sample
```{r rt_head}
head(rt, 5) %>%
    kable(format = "html", escape = F) %>%
    kable_styling(bootstrap_options = "striped", full_width = F, 
                  position = "left")
```

### column classes/data types
```{r rt_col_classes}
as.data.frame(sapply(rt, class), stringsAsFactors = F) %>%
    rownames_to_column() %>%
    mutate(class_type = `sapply(rt, class)`) %>%
    column_to_rownames(var = "rowname") %>%
    select(class_type) %>%
    kable(format = "html", escape = F) %>%
    kable_styling(bootstrap_options = "striped", full_width = F, 
                  position = "left")
```

### max column width (in characters)
```{r rt_max_col_width}
as.data.frame(sapply(rt, function(x){max(nchar(x, keepNA = F))})) %>%
    rownames_to_column() %>%
    mutate(max_num_char = `sapply(rt, function(x) {     max(nchar(x, keepNA = F)) })`) %>%
    column_to_rownames(var = "rowname") %>%
    select(max_num_char) %>%
    kable(format = "html", escape = F) %>%
    kable_styling(bootstrap_options = "striped", full_width = F, 
                  position = "left")
```

### missing/null values index number
```{r rt_missing}
sapply(rt, function(x){which(is.na(x))})
```

Column
-------------------------------------------------------------------------------
### unique Client values
```{r unique_Code_rt}
unlist(lapply(rt, function(x){sort(unique(x), decreasing = F, na.last = T)})[[4]])
```

### unique Staff values
```{r unique_Staff_rt}
unlist(lapply(rt, function(x){sort(unique(x), decreasing = F, na.last = T)})[[5]])
```

```{r}
rm(rt)
```

Service Listing {data-navmenu="Pre-DB Explore"}
===============================================================================

```{r read_service_listing}
sl <- read_csv(datafilepaths[6])
```

Column
-------------------------------------------------------------------------------

### data file

**Service Listing**

### data dimensions
```{r sl_dim, fig.height=2}
dim(sl)
```

### data sample
```{r sl_head}
head(sl, 5) %>%
    kable(format = "html", escape = F) %>%
    kable_styling(bootstrap_options = "striped", full_width = F, 
                  position = "left")
```

### column classes/data types
```{r sl_col_classes}
as.data.frame(sapply(sl, class), stringsAsFactors = F) %>%
    rownames_to_column() %>%
    mutate(class_type = `sapply(sl, class)`) %>%
    column_to_rownames(var = "rowname") %>%
    select(class_type) %>%
    kable(format = "html", escape = F) %>%
    kable_styling(bootstrap_options = "striped", full_width = F, 
                  position = "left")
```

### max column width (in characters)
```{r sl_max_col_width}
as.data.frame(sapply(sl, function(x){max(nchar(x, keepNA = F))})) %>%
    rownames_to_column() %>%
    mutate(max_num_char = `sapply(sl, function(x) {     max(nchar(x, keepNA = F)) })`) %>%
    column_to_rownames(var = "rowname") %>%
    select(max_num_char) %>%
    kable(format = "html", escape = F) %>%
    kable_styling(bootstrap_options = "striped", full_width = F, 
                  position = "left")
```

### missing/null values index number
```{r sl_missing}
sapply(sl, function(x){which(is.na(x))})
```

Column
-------------------------------------------------------------------------------
### unique Code values
```{r unique_Code_sl}
unlist(lapply(sl, function(x){sort(unique(x), decreasing = F, na.last = T)})[[2]])
```

### unique Description values
```{r unique_Description_sl}
unlist(lapply(sl, function(x){sort(unique(x), decreasing = F, na.last = T)})[[3]])
```

### unique Category values
```{r unique_Category_sl}
unlist(lapply(sl, function(x){sort(unique(x), decreasing = F, na.last = T)})[[4]])
```

```{r}
rm(sl)
```

Starting Data Tables/Files {data-navmenu="DB Creation"}
===============================================================================

### Raw Data Table Names and Columns

```{r pull_name_and_cols}
# initialize empty vector and list
tablename <- vector(length = length(datafilenames))

tablecols <- vector(mode = "list", length = length(datafilenames))


# get table names and column headings
for (i in 1:length(datafilepaths)){
    
    # extract table name from filename
    tablename[i] <- str_split(datafilenames[i], ".csv") %>%
        unlist() %>%
        .[1]
    
    # temp hold of column names in list
    tablecols[[i]] <- read_csv(datafilepaths[i], n_max = 1) %>%
        names()
    
    rm(i)
}

# create empty dataframe
tempdf <- as.data.frame(matrix(nrow = 14, ncol = 6))

# fill dataframe
names(tempdf) <- tablename

for (i in 1:ncol(tempdf)){
    
    ntimes <- nrow(tempdf) - length(tablecols[[i]])
    
    tempdf[i] <- c(tablecols[[i]], rep("---", times = ntimes))
    
    rm(i, ntimes)
    
}

rm (tablename, tablecols)

# display table names and columns in chart
tempdf %>%
    kable(format = "html", escape = F) %>%
    kable_styling(bootstrap_options = "striped", full_width = F, 
                  position = "left")

# clean memory
rm (tempdf)
```


DB Structure After Redesign {data-navmenu="DB Creation"}
===============================================================================



Data Dictionary {data-navmenu="DB Creation"}
===============================================================================

