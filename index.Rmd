---
title: "Hair Salon No-Show Analysis"
author: "G. Conway"
knit: (function(inputFile, encoding) {
      out_dir <- 'docs';
      rmarkdown::render(inputFile,
                        encoding=encoding,
                        output_file=file.path(dirname(inputFile), out_dir, 'index.html')) })
output:
  flexdashboard::flex_dashboard:
    orientation: row
    vertical_layout: scroll
    theme: cerulean
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE)
```

```{r packages, message=FALSE}
# check if package is installed and then load package for use
source("R_scripts/requirements.R")
```

```{r data_file_names}
# get data file paths
source("R_scripts/data_file_names.R")
```

Welcome
===============================================================================

Row
-----------------------------------------------------------------------

### <b>Project Status</b>

![](https://img.shields.io/badge/Project--Status-50%25-yellow)
![](https://img.shields.io/badge/Last%20Updated-Nov%2018%2C%202020-blue)

Current focus area(s):

* EDA, feature engineering, determine modeling goal(s) & method(s).
* Determine if I want to use R or Python for remaining analysis.


### <b>Project Description</b>

This project explores insights about hair salon appointments.

Row{data-height=250}
-----------------------------------------------------------------------

### <b>Notes</b>

* **Source code** for this project can be found on my GitHub repo at [Hair_Salon_No_Show](https://github.com/gconway012/Hair_Salon_No-Show) in the *index.Rmd* file. 

* This website is best viewed with a large/maximized window. A larger monitor/screen (24" or larger) may be required.  

* Names were changed as an additional privacy consideration.

### <b>Project Scenario</b>

* A small hair salon wants to understand its business and related data to better serve their clients.  
* Although they use a POS system, the owner/manager would like to look deeper than the receipts.  
* The salon manager and select staff members indicated that they typically use Excel to generate reports and/or review data. However, they feel that using Excel is becoming obsolete for their needs.  
* As an exploratory step before developing a longer-term strategy for their data and analytics needs, the business would like to see an example(s) of:  
    + A better data management tool/platform.  
    + Another type of dashboarding and/or reporting tool/platform.  
    + Insights to be gained from those dashboards/reports.  
    + Different analysis techniques employed and what insights those methods can provide.  

Row
-----------------------------------------------------------------------

### <b>Software, Packages, Extensions & Languages</b>

|Software Used|Packages Used|(Helpful) VS Code Extensions|Coding Languages Used|
|:---|:---|:---|:---|
|Mac OSx Catalina|tidyverse|Ascii Tree Generator|R|
|R|kableExtra|Bracket Pair Colorizer 2|MySQL|
|RStudio|RMySQL|vscode-icons|HTML|
|MySQL Community Server|plotly|||
|MySQL Workbench|DT|||
|Microsoft VS Code||||
|Microsoft Excel||||

<br>

\*Refer to [README.md](https://github.com/gconway012/Hair_Salon_No-Show) for the list of each software, package, and extension version used for this project.

### <b>Non-Scenario Project Goals</b>

* Use R/RStudio & MySQL, separately and as integrated tools, to perform analysis.
* Set up a database schema as a simulated business requirement, which includes:
    + Raw data exploration
    + Database table design and relationship identification
    + Raw data extraction and upload into MySQL
* Use flexdashboards in RStudio/RMarkdown as a workflow framework
* Develop dashboard page(s) 
* Use HTML tags and other packages to experiement with RMarkdown HTML output file and Markdown document design features
* Practice other modeling techniques


About {data-navmenu="Pre-DB Explore"}
===============================================================================

### <b>About Pre-DB Exploration</b>

* The information contained on each page under the **Pre-DB Explore** tab was used to gather information used for a MySQL database design and corresponding table creation.

<br>

* This information helped:
  + identify what tables to create
  + determine how each table could/would link to one another
  + determine their respective primary & foreign keys


Client Cancellations {data-navmenu="Pre-DB Explore"}
===============================================================================

```{r read_client_cancel}
cc <- read_csv(datafilepaths[1])
```

Row
-------------------------------------------------------------------------------

### <b>data file</b>

**Client Cancellations**

### <b>data dimensions</b>
```{r cc_dim}
t(as.data.frame(dim(cc), row.names = c("nrow", "ncol"))) %>%
  magrittr::set_rownames(value = "") %>%
  kable(format = "html", escape = F) %>%
  kable_styling(bootstrap_options = "striped", full_width = F,
                position = "left")
```

Row
-------------------------------------------------------------------------------

### <b>column classes/data types</b>
```{r cc_col_classes}
as.data.frame(sapply(cc, class), stringsAsFactors = F) %>%
                rownames_to_column() %>%
                mutate(class_type = `sapply(cc, class)`) %>%
                column_to_rownames(var = "rowname") %>%
                select(class_type) %>%
                kable(format = "html", escape = F) %>%
                kable_styling(bootstrap_options = "striped", full_width = F, 
                              position = "left")
```


### <b>data sample</b>
```{r cc_head}
head(cc, 5) %>%
                kable(format = "html", escape = F) %>%
                kable_styling(bootstrap_options = "striped", full_width = F, 
                              position = "left")
```

Row
-------------------------------------------------------------------------------

### <b>max column width (in characters)</b>
```{r cc_max_col_width}
as.data.frame(sapply(cc, function(x){max(nchar(x, keepNA = F))})) %>%
                rownames_to_column() %>%
                mutate(max_num_char = `sapply(cc, function(x) {     max(nchar(x, keepNA = F)) })`) %>%
                column_to_rownames(var = "rowname") %>%
                select(max_num_char) %>%
                kable(format = "html", escape = F) %>%
                kable_styling(bootstrap_options = "striped", full_width = F, 
                              position = "left")
```

### <b>missing/null values index number</b>
```{r cc_missing}
as.data.frame(t(sapply(cc, function(x){which(is.na(x))}))) %>%
                kable(format = "html", escape = F) %>%
                kable_styling(bootstrap_options = "striped", full_width = F, 
                              position = "left")


```


Row
-------------------------------------------------------------------------------

### <b>unique Code values</b> {data-width=300}
```{r cc_unique_Code}
matrix(lapply(cc,
              function(x){sort(unique(x),
                               decreasing = F, na.last = T)})[[2]],
       nrow = 10, ncol = 5) %>%
  kable(format = "html", escape = F) %>%
  kable_styling(bootstrap_options = "striped", full_width = F,
                position = "left")
```

### <b>unique Service values</b> {data-width=300}
```{r cc_unique_Service}
matrix(c(unlist(lapply(cc,
                       function(x){sort(unique(x), decreasing = F,
                                        na.last = T)})[[3]]),
         "-place_holder-"), nrow = 6, ncol = 4) %>%
  kable(format = "html", escape = F) %>%
  kable_styling(bootstrap_options = "striped", full_width = F,
                position = "left")
```


### <b>unique Staff values</b> {data-width=200}
```{r cc_unique_Staff}
matrix(unlist(lapply(cc,
                     function(x){sort(unique(x), decreasing = F,
                                      na.last = T)})[[4]]),
       nrow = 2, ncol = 3) %>%
  kable(format = "html", escape = F) %>%
  kable_styling(bootstrap_options = "striped", full_width = F,
                position = "left")
```

### <b>unique Cancelled By values</b> {data-width=200}
```{r cc_unique_CanceledBy}
matrix(c(unlist(lapply(cc,
                       function(x){sort(unique(x), decreasing = F,
                                        na.last = T)})[[6]]),
         rep("-place_holder-", times = 2)), nrow = 3, ncol = 3) %>%
  kable(format = "html", escape = F) %>%
  kable_styling(bootstrap_options = "striped", full_width = F,
                position = "left")
```

```{r clear_cc_var}
rm(cc)
```


Future Bookings {data-navmenu="Pre-DB Explore"}
===============================================================================

```{r read_future_bookings}
fb <- read_csv(datafilepaths[2],
               col_types = cols(Code = col_character(),
                             Staff = col_character(),
                             Service = col_character(),
                             Date = col_character(),
                             Time = col_character(),
                             TimeInt = col_double())
               )
```

Row
-------------------------------------------------------------------------------

### <b>data file</b>

**Future Bookings**

### <b>data dimensions</b>
```{r fb_dim}
t(as.data.frame(dim(fb), row.names = c("nrow", "ncol"))) %>%
  magrittr::set_rownames(value = "") %>%
  kable(format = "html", escape = F) %>%
  kable_styling(bootstrap_options = "striped", full_width = F,
                position = "left")
```

Row
-------------------------------------------------------------------------------

### <b>column classes/data types</b>
```{r fb_col_classes}
as.data.frame(sapply(fb, class), stringsAsFactors = F) %>%
    rownames_to_column() %>%
    mutate(class_type = `sapply(fb, class)`) %>%
    column_to_rownames(var = "rowname") %>%
    select(class_type) %>%
    kable(format = "html", escape = F) %>%
    kable_styling(bootstrap_options = "striped", full_width = F, 
                  position = "left")
```


### <b>data sample</b>
```{r fb_head}
head(fb, 5) %>%
    kable(format = "html", escape = F) %>%
    kable_styling(bootstrap_options = "striped", full_width = F, 
                  position = "left")
```

Row
-------------------------------------------------------------------------------

### <b>max column width (in characters)</b>
```{r fb_max_col_width}
as.data.frame(sapply(fb, function(x){max(nchar(x, keepNA = F))})) %>%
    rownames_to_column() %>%
    mutate(max_num_char = `sapply(fb, function(x) {     max(nchar(x, keepNA = F)) })`) %>%
    column_to_rownames(var = "rowname") %>%
    select(max_num_char) %>%
    kable(format = "html", escape = F) %>%
    kable_styling(bootstrap_options = "striped", full_width = F, 
                  position = "left")
```

### <b>missing/null values index number</b>
```{r fb_missing, fig.height=8.5}
as.data.frame(t(sapply(fb, function(x){which(is.na(x))}))) %>%
                kable(format = "html", escape = F) %>%
                kable_styling(bootstrap_options = "striped", full_width = F, 
                              position = "left")
```

Row
-------------------------------------------------------------------------------

### <b>unique Staff values</b>
```{r fb_unique_staff, fig.height=2}
t(matrix(lapply(fb, function(x){sort(unique(x), 
                                     decreasing = F, 
                                     na.last = T)})[[2]],
       nrow = 1, ncol = 7)) %>%
  kable(format = "html", escape = F) %>%
  kable_styling(bootstrap_options = "striped", full_width = F, 
                              position = "left")
```

### <b>unique Service values</b>
```{r unique_Service_fb, fig.height=2}
matrix(c(unlist(lapply(fb, function(x){sort(unique(x), 
                                     decreasing = F, 
                                     na.last = T)})[[3]]), "-place_holder-"),
       nrow = 6, ncol = 5) %>%
  kable(format = "html", escape = F) %>%
  kable_styling(bootstrap_options = "striped", full_width = F, 
                              position = "left")
```

Row
-------------------------------------------------------------------------------

### <b>unique Code values</b>
```{r fb_unique_Code}
matrix(c(unlist(lapply(fb, function(x){sort(unique(x), 
                                     decreasing = F, 
                                     na.last = T)})[[1]]), 
  rep("-place_holder", times = 5)),
       nrow = 50, ncol = 16) %>%
  kable(format = "html", escape = F) %>%
  kable_styling(bootstrap_options = "striped", full_width = F,
                position = "left")
```


```{r clear_fb_var}
rm(fb)
```

No_Show Report {data-navmenu="Pre-DB Explore"}
===============================================================================

```{r read_no_show}
ns <- read_csv(datafilepaths[3])
```

Row
-------------------------------------------------------------------------------

### <b>data file</b>

**No_Show Report**

### <b>data dimensions</b>
```{r ns_dim}
t(as.data.frame(dim(ns), row.names = c("nrow", "ncol"))) %>%
  magrittr::set_rownames(value = "") %>%
  kable(format = "html", escape = F) %>%
  kable_styling(bootstrap_options = "striped", full_width = F,
                position = "left")
```

Row
-------------------------------------------------------------------------------

### <b>column classes/data types</b>
```{r ns_col_classes}
as.data.frame(sapply(ns, class), stringsAsFactors = F) %>%
    rownames_to_column() %>%
    mutate(class_type = `sapply(ns, class)`) %>%
    column_to_rownames(var = "rowname") %>%
    select(class_type) %>%
    kable(format = "html", escape = F) %>%
    kable_styling(bootstrap_options = "striped", full_width = F, 
                  position = "left")
```

### <b>data sample</b>
```{r ns_head}
head(ns, 5) %>%
    kable(format = "html", escape = F) %>%
    kable_styling(bootstrap_options = "striped", full_width = F, 
                  position = "left")
```

Row
-------------------------------------------------------------------------------

### <b>max column width (in characters)</b>
```{r ns_max_col_width}
as.data.frame(sapply(ns, function(x){max(nchar(x, keepNA = F))})) %>%
    rownames_to_column() %>%
    mutate(max_num_char = `sapply(ns, function(x) {     max(nchar(x, keepNA = F)) })`) %>%
    column_to_rownames(var = "rowname") %>%
    select(max_num_char) %>%
    kable(format = "html", escape = F) %>%
    kable_styling(bootstrap_options = "striped", full_width = F, 
                  position = "left")
```

### <b>missing/null values index number</b>
```{r ns_missing}
as.data.frame(t(sapply(ns, function(x){which(is.na(x))}))) %>%
                kable(format = "html", escape = F) %>%
                kable_styling(bootstrap_options = "striped", full_width = F, 
                              position = "left")
```

Row
-------------------------------------------------------------------------------

### <b>unique Code values</b>
```{r unique_Code_ns}
matrix(unlist(lapply(ns, function(x){sort(unique(x), 
                                     decreasing = F, 
                                     na.last = T)})[[2]]),
       nrow = 5, ncol = 10) %>%
  kable(format = "html", escape = F) %>%
  kable_styling(bootstrap_options = "striped", full_width = F,
                position = "left")
```

### <b>unique Service values</b>
```{r unique_Description_ns}
matrix(c(unlist(lapply(ns, 
                       function(x){sort(unique(x), 
                                        decreasing = F, na.last = T)})[[3]]), 
         rep("-place_holder-", times = 4)), 
       nrow = 5, ncol = 3) %>%
  kable(format = "html", escape = F) %>%
  kable_styling(bootstrap_options = "striped", full_width = F,
                position = "left")
```

### <b>unique Staff values</b>
```{r unique_Category_ns}
matrix(unlist(lapply(ns, 
                     function(x){sort(unique(x), decreasing = F, 
                                      na.last = T)})[[4]]), 
       nrow = 3, ncol = 2) %>%
  kable(format = "html", escape = F) %>%
  kable_styling(bootstrap_options = "striped", full_width = F,
                position = "left")
```

```{r clear_ns_var}
rm(ns)
```

Product Listing-Retail {data-navmenu="Pre-DB Explore"}
===============================================================================

```{r read_product_listing_retail}
plr <- read_csv(datafilepaths[4])
```

Row
-------------------------------------------------------------------------------

### <b>data file</b>

**Product Listing-Retail**

### <b>data dimensions</b>
```{r plr_dim}
t(as.data.frame(dim(plr), row.names = c("nrow", "ncol"))) %>%
  magrittr::set_rownames(value = "") %>%
  kable(format = "html", escape = F) %>%
  kable_styling(bootstrap_options = "striped", full_width = F,
                position = "left")
```

Row
-------------------------------------------------------------------------------

### <b>column classes/data types</b> {data-width=150}
```{r plr_col_classes}
as.data.frame(sapply(plr, class), stringsAsFactors = F) %>%
    rownames_to_column() %>%
    mutate(class_type = `sapply(plr, class)`) %>%
    column_to_rownames(var = "rowname") %>%
    select(class_type) %>%
    kable(format = "html", escape = F) %>%
    kable_styling(bootstrap_options = "striped", full_width = F, 
                  position = "left")
```

### <b>data sample</b>
```{r plr_head}
head(plr, 5) %>%
    kable(format = "html", escape = F) %>%
    kable_styling(bootstrap_options = "striped", full_width = F, 
                  position = "left")
```

Row
-------------------------------------------------------------------------------

### <b>max column width (in characters)</b> {data-width=150}
```{r plr_max_col_width}
as.data.frame(sapply(plr, function(x){max(nchar(x, keepNA = F))})) %>%
    rownames_to_column() %>%
    mutate(max_num_char = `sapply(plr, function(x) {     max(nchar(x, keepNA = F)) })`) %>%
    column_to_rownames(var = "rowname") %>%
    select(max_num_char) %>%
    kable(format = "html", escape = F) %>%
    kable_styling(bootstrap_options = "striped", full_width = F, 
                  position = "left")
```

### <b>missing/null values index number</b>
```{r plr_missing}
# get info
missinglist <- sapply(plr, function(x){which(is.na(x))})

# format results
tempdf <- as.data.frame(matrix(nrow = 3, 
                               ncol = 14, 
                               dimnames = list(c("", "",""), 
                                               c(names(missinglist)))))

# loop assignments not working right 
# -- had to do direct assignments to cols for display  purposes
tempdf[, 1] <- missinglist[[1]]
tempdf[, 2] <- missinglist[[2]]
tempdf[, 3] <- c(missinglist[[3]], NA, NA)
tempdf[, 4] <- missinglist[[4]]
tempdf[, 5] <- missinglist[[5]]
tempdf[, 6] <- c(missinglist[[6]], NA)
tempdf[, 7] <- missinglist[[7]]
tempdf[, 8] <- missinglist[[8]]
tempdf[, 9] <- missinglist[[9]]
tempdf[, 10] <- missinglist[[10]]
tempdf[, 11] <- missinglist[[11]]
tempdf[, 12] <- missinglist[[12]]
tempdf[, 13] <- missinglist[[13]]
tempdf[, 14] <- missinglist[[14]]

# remove row names
rownames(tempdf) <- NULL

# make all cols character class & remove NAs
tempdf <- sapply(tempdf, as.character)

tempdf[which(is.na(tempdf))] <- ""

# show the info
tempdf %>%
    kable(format = "html", escape = F) %>%
    kable_styling(bootstrap_options = "striped", full_width = F, 
                  position = "left")

# clear temp variables
rm(missinglist, tempdf)
```

Row
-------------------------------------------------------------------------------

### <b>unique Supplier values</b> {data-width=200}
```{r unique_Supplier_plr}
matrix(lapply(plr, 
              function(x){sort(unique(x), 
                               decreasing = F, na.last = T)})[[4]]) %>%
    kable(format = "html", escape = F) %>%
    kable_styling(bootstrap_options = "striped", full_width = F, 
                  position = "left")
```

### <b>unique Brand values</b> {data-width=300}
```{r unique_Brand_plr, fig.height=2}
matrix(c(lapply(plr, 
                 function(x){sort(unique(x), decreasing = F, 
                                  na.last = T)})[[5]], 
         rep("-place_holder", times = 2)),
         nrow = 3, ncol = 3) %>%
    kable(format = "html", escape = F) %>%
    kable_styling(bootstrap_options = "striped", full_width = F, 
                  position = "left")
```

### <b>unique Category values</b> {data-width=200}
```{r unique_Category_plr, fig.height=2}
matrix(sapply(plr, 
              function(x){sort(unique(x), decreasing = F, 
                               na.last = T)})[[6]]) %>%
    kable(format = "html", escape = F) %>%
    kable_styling(bootstrap_options = "striped", full_width = F, 
                  position = "left")
```

Row
-------------------------------------------------------------------------------

### <b>unique Code values</b>
```{r unique_Code_plr, fig.height=4.5}
matrix(c(unlist(lapply(plr, function(x){sort(unique(x), decreasing = F, na.last = T)})[[2]]),
         rep("-place_holder-", times = 9)), 
       nrow = 11, ncol = 10) %>%
    kable(format = "html", escape = F) %>%
    kable_styling(bootstrap_options = "striped", full_width = F, 
                  position = "left")
```

Row
-------------------------------------------------------------------------------

### <b>unique Description values</b>
```{r unique_Description_plr}
matrix(c(unlist(lapply(plr, 
                       function(x){sort(unique(x), decreasing = F, 
                                        na.last = T)})[[3]]),
         rep("-place_holder-", times = 9)), 
       nrow = 11, ncol = 10) %>%
    kable(format = "html", escape = F) %>%
    kable_styling(bootstrap_options = "striped", full_width = F, 
                  position = "left")
```


```{r clear_plr_var}
rm(plr)
```

Receipt Transactions {data-navmenu="Pre-DB Explore"}
===============================================================================

```{r read_receipt_trans}
rt <- read_csv(datafilepaths[5])
```

Row
-------------------------------------------------------------------------------

### <b>data file</b>

**Receipt Transactions**

### <b>data dimensions</b>
```{r rt_dim, fig.height=2}
t(as.data.frame(dim(rt), row.names = c("nrow", "ncol"))) %>%
  magrittr::set_rownames(value = "") %>%
  kable(format = "html", escape = F) %>%
  kable_styling(bootstrap_options = "striped", full_width = F,
                position = "left")
```

Row
-------------------------------------------------------------------------------

### <b>column classes/data types</b> {data-width=350}
```{r rt_col_classes}
as.data.frame(sapply(rt, class), stringsAsFactors = F) %>%
    rownames_to_column() %>%
    mutate(class_type = `sapply(rt, class)`) %>%
    column_to_rownames(var = "rowname") %>%
    select(class_type) %>%
    kable(format = "html", escape = F) %>%
    kable_styling(bootstrap_options = "striped", full_width = F, 
                  position = "left")
```

### <b>data sample</b>
```{r rt_head}
head(rt, 5) %>%
    kable(format = "html", escape = F) %>%
    kable_styling(bootstrap_options = "striped", full_width = F, 
                  position = "left")
```


Row
-------------------------------------------------------------------------------

### <b>max column width (in characters)</b> {data-width=200}
```{r rt_max_col_width}
as.data.frame(sapply(rt, function(x){max(nchar(x, keepNA = F))})) %>%
    rownames_to_column() %>%
    mutate(max_num_char = `sapply(rt, function(x) {     max(nchar(x, keepNA = F)) })`) %>%
    column_to_rownames(var = "rowname") %>%
    select(max_num_char) %>%
    kable(format = "html", escape = F) %>%
    kable_styling(bootstrap_options = "striped", full_width = F, 
                  position = "left")
```

### <b>missing/null values index number</b> {data-width=500}
```{r rt_missing}
# get info
missinglist <- sapply(rt, function(x){which(is.na(x))})

# format results
tempdf <- as.data.frame(matrix(nrow = 3, 
                               ncol = 9, 
                               dimnames = list(c("", "",""), 
                                               c(names(missinglist)))))

# loop assignments not working right 
# -- had to do direct assignments to cols for display  purposes
tempdf[, 1] <- missinglist[[1]]
tempdf[, 2] <- missinglist[[2]]
tempdf[, 3] <- missinglist[[3]]
tempdf[, 4] <- missinglist[[4]]
tempdf[, 5] <- missinglist[[5]]
tempdf[, 6] <- missinglist[[6]]
tempdf[, 7] <- missinglist[[7]]
tempdf[, 8] <- missinglist[[8]]
tempdf[, 9] <- missinglist[[9]]

# remove row names
rownames(tempdf) <- NULL

# make all cols character class & remove NAs
tempdf <- sapply(tempdf, as.character)

tempdf[which(is.na(tempdf))] <- ""

# show the info
tempdf %>%
    kable(format = "html", escape = F) %>%
    kable_styling(bootstrap_options = "striped", full_width = F, 
                  position = "left")

# clear temp variables
rm(missinglist, tempdf)
```

### <b>unique Staff values</b> {data-width=300}
```{r rt_unique_Staff}
matrix(c(lapply(rt, 
         function(x){sort(unique(x), 
                          decreasing = F, 
                          na.last = T)})[[5]],
         rep("-place_holder-", times = 2)),
       nrow = 3, ncol = 3) %>%
    kable(format = "html", escape = F) %>%
    kable_styling(bootstrap_options = "striped", full_width = F, 
                  position = "left")
```

Column
-------------------------------------------------------------------------------
### <b>unique Client values</b>
```{r rt_unique_Code}
matrix(lapply(rt, 
              function(x){sort(unique(x), 
                               decreasing = F, 
                               na.last = T)})[[4]],
       nrow = 59, ncol = 13) %>%
    kable(format = "html", escape = F) %>%
    kable_styling(bootstrap_options = "striped", full_width = F, 
                  position = "left")
```


```{r clear_rt_var}
rm(rt)
```

Service Listing {data-navmenu="Pre-DB Explore"}
===============================================================================

```{r read_service_listing}
sl <- read_csv(datafilepaths[6])
```

Row
-------------------------------------------------------------------------------

### <b>data file</b>

**Service Listing**

### <b>data dimensions</b>
```{r sl_dim}
t(as.data.frame(dim(sl), row.names = c("nrow", "ncol"))) %>%
  magrittr::set_rownames(value = "") %>%
  kable(format = "html", escape = F) %>%
  kable_styling(bootstrap_options = "striped", full_width = F,
                position = "left")
```

Row
-------------------------------------------------------------------------------

### <b>column classes/data types</b>
```{r sl_col_classes}
as.data.frame(sapply(sl, class), stringsAsFactors = F) %>%
    rownames_to_column() %>%
    mutate(class_type = `sapply(sl, class)`) %>%
    column_to_rownames(var = "rowname") %>%
    select(class_type) %>%
    kable(format = "html", escape = F) %>%
    kable_styling(bootstrap_options = "striped", full_width = F, 
                  position = "left")
```

### <b>data sample</b>
```{r sl_head}
head(sl, 5) %>%
    kable(format = "html", escape = F) %>%
    kable_styling(bootstrap_options = "striped", full_width = F, 
                  position = "left")
```

Row
-------------------------------------------------------------------------------

### <b>max column width (in characters)</b>
```{r sl_max_col_width}
as.data.frame(sapply(sl, function(x){max(nchar(x, keepNA = F))})) %>%
    rownames_to_column() %>%
    mutate(max_num_char = `sapply(sl, function(x) {     max(nchar(x, keepNA = F)) })`) %>%
    column_to_rownames(var = "rowname") %>%
    select(max_num_char) %>%
    kable(format = "html", escape = F) %>%
    kable_styling(bootstrap_options = "striped", full_width = F, 
                  position = "left")
```

### <b>missing/null values index number</b>
```{r sl_missing}
as.data.frame(t(sapply(sl, function(x){which(is.na(x))}))) %>%
                kable(format = "html", escape = F) %>%
                kable_styling(bootstrap_options = "striped", full_width = F, 
                              position = "left")
```

### <b>unique Category values</b>
```{r unique_Category_sl}
matrix(unlist(sapply(sl, 
                     function(x){sort(unique(x), 
                                      decreasing = F, 
                                      na.last = T)})[[4]])) %>%
  kable(format = "html", escape = F) %>%
  kable_styling(bootstrap_options = "striped", full_width = F,
                position = "left")
```

Row
-------------------------------------------------------------------------------
### <b>unique Code values</b>
```{r sl_unique_Code}
matrix(unlist(lapply(sl, 
                     function(x){sort(unique(x), 
                                      decreasing = F, 
                                      na.last = T)})[[2]]), 
       nrow = 3, ncol = 11) %>%
  kable(format = "html", escape = F) %>%
  kable_styling(bootstrap_options = "striped", full_width = F,
                position = "left")
```

Row
-------------------------------------------------------------------------------

### <b>unique Description values</b>
```{r sl_unique_Description}
matrix(unlist(lapply(sl, 
                     function(x){sort(unique(x), 
                                      decreasing = F, 
                                      na.last = T)})[[3]]), 
       nrow = 3, ncol = 11) %>%
  kable(format = "html", escape = F) %>%
  kable_styling(bootstrap_options = "striped", full_width = F,
                position = "left")
```


```{r clear_sl_var}
rm(sl)
```

Starting Data Tables/Files {data-navmenu="DB Creation"}
===============================================================================

### <b>Raw Data Table Names and Columns</b>

```{r pull_name_and_cols}
# initialize empty vector and list
tablename <- vector(length = length(datafilenames))

tablecols <- vector(mode = "list", length = length(datafilenames))


# get table names and column headings
for (i in 1:length(datafilepaths)){
    
    # extract table name from filename
    tablename[i] <- str_split(datafilenames[i], ".csv") %>%
        unlist() %>%
        .[1]
    
    # temp hold of column names in list
    tablecols[[i]] <- read_csv(datafilepaths[i], n_max = 1) %>%
        names()
    
    rm(i)
}

# create empty dataframe
tempdf <- as.data.frame(matrix(nrow = 14, ncol = 6))

# fill dataframe
names(tempdf) <- tablename

for (i in 1:ncol(tempdf)){
    
    ntimes <- nrow(tempdf) - length(tablecols[[i]])
    
    tempdf[i] <- c(tablecols[[i]], rep("---", times = ntimes))
    
    rm(i, ntimes)
    
}

rm (tablename, tablecols)

# display table names and columns in chart
tempdf %>%
    kable(format = "html", escape = F) %>%
    kable_styling(bootstrap_options = "striped", full_width = F, 
                  position = "left")

# clean memory
rm (tempdf)
```


DB Structure After Redesign {data-navmenu="DB Creation"}
===============================================================================

Row 
-------------------------------------------------------------------------------

![](img_files/hair_salon_noshow_erd.jpg)


Data Dictionary Notes{data-navmenu="DB Creation"}
===============================================================================

### <b>Notes/observations about the data</b>
* Column headings were renamed in MySQL tables for clarity.

* While reviewing table data during database construction, certain column calculations were identified. The select calculations identified are as follows:

<br>

| SQL Table | Column | Notes/Meaning |
| :--- | :--- | :--- |
| product_listing | COG | calculated as $COG = num\_on\_hand * cost$; COG definition/meaning is unknown |
| retail_transactions | GST | calculated as $GST = Amount * 0.05$; GST assumed to mean "Govt. Sales Tax" |
| retail_transactions | PST | calculated as $PST = Amount * 0.08$; PST assumed to mean "Provincial Sales Tax" |

Sales/Revenue {data-navmenu="Dashboards"}
===============================================================================

```{r database_connect}
source("connect_db.R")
```

```{r source_sales_queries}
source("R_scripts/sales_queries.R")
```

Row
-------------------------------------------------------------------------------

### <b>Date Range (Receipt Transactions)</b>

```{r receipts_date_range}
sales_query("date_range_receipts") %>%
  kable(format = "html", escape = F) %>%
    kable_styling(bootstrap_options = "striped", full_width = F, 
                  position = "left")
```


### <b>Total Sales</b>

```{r total_sales}
flexdashboard::valueBox(sales_query("total_sales"),
                        icon = "fa-usd",
                        color = "lightgreen")
```


### <b>Total Sales (Services)</b>

```{r total_services_sales}
flexdashboard::valueBox(sales_query("total_services_sales"),
                        icon = "fa-usd",
                        color = "lightblue")
```


### <b>Total Sales (Products)</b>

```{r total_product_sales}
flexdashboard::valueBox(sales_query("total_products_sales"),
                        icon = "fa-usd",
                        color = "#ffaf87")
```


### <b>Total Sales (MISC - Service and/or Product)</b>

```{r misc_sales}
flexdashboard::valueBox(sales_query("misc_sales"),
                        icon = "fa-usd",
                        color = "#ffffd7")
```

Row
-------------------------------------------------------------------------------

### <b># Services Offered (Active)</b>

```{r num_services_offered}
flexdashboard::valueBox(sales_query("num_services_offered"),
                        icon = "fa-group",
                        color = "LightSteelBlue")
```


### <b># Products Offered (Active)</b>

```{r num_products_offered}
flexdashboard::valueBox(sales_query("num_products_offered"),
                        icon = "fa-cubes",
                        color = "LightSteelBlue")
```

Row
-------------------------------------------------------------------------------

### <b>Products Out-of-Stock (Active)</b>

```{r products_out_of_stock}
sales_query("products_oos") %>%
  kable(format = "html", escape = F) %>%
    kable_styling(bootstrap_options = "striped", full_width = F, 
                  position = "left")
```

Row
-------------------------------------------------------------------------------

### <b>Top 10 Services</b>

```{r top_ten_services}
sales_query("top_ten_services") %>%
  kable(format = "html", escape = F) %>%
    kable_styling(bootstrap_options = "striped", full_width = F, 
                  position = "left")
```


### <b>Top 10 Products</b>

```{r top_ten_products}
sales_query("top_ten_products") %>%
  kable(format = "html", escape = F) %>%
    kable_styling(bootstrap_options = "striped", full_width = F, 
                  position = "left")
```


Row
-------------------------------------------------------------------------------

### <b>Bottom 5 Services</b>

```{r bottom_five_services}
sales_query("bottom_five_services") %>%
  kable(format = "html", escape = F) %>%
    kable_styling(bootstrap_options = "striped", full_width = F, 
                  position = "left")
```


### <b>Bottom 5 Products</b>

```{r bottom_five_products}
sales_query("bottom_five_products") %>%
  kable(format = "html", escape = F) %>%
    kable_styling(bootstrap_options = "striped", full_width = F, 
                  position = "left")
```


Row
-------------------------------------------------------------------------------

### <b>Daily Sales</b>

```{r daily_sales_plot}
sales_query("daily_sales")
```

Row
-------------------------------------------------------------------------------

### <b>Sales by Week</b>

```{r sales_by_week}
sales_query("sales_by_week")
```

Row
-------------------------------------------------------------------------------

### <b>Daily Sales by Day-of-the-Week (DOW)</b>

```{r daily_sales_by_DOW_plot}
sales_query("daily_sales_isolated_DOW")
```


Row
-------------------------------------------------------------------------------

### <b>Total Sales Aggregated by (DOW)</b>

```{r DOW_sales_aggregated}
sales_query("DOW_sales_aggregated")
```


Clients {data-navmenu="Dashboards"}
===============================================================================

```{r source_client_queries}
source("R_scripts/client_queries.R")
```

Row
-------------------------------------------------------------------------------

### <b>Date Range - Receipts</b>

```{r receipts_date_range2}
sales_query("date_range_receipts") %>%
  kable(format = "html", escape = F) %>%
    kable_styling(bootstrap_options = "striped", full_width = F,
                  position = "left")
```

### <b>Date Range - Cancellations</b>

```{r cancellations_date_range}
clients_query("date_range_cancellations") %>%
  kable(format = "html", escape = F) %>%
    kable_styling(bootstrap_options = "striped", full_width = F, 
                  position = "left")
```


Row
-------------------------------------------------------------------------------

### <b>Date Range - No-Show Report</b>

```{r noshow_date_range}
clients_query("date_range_noshow_report") %>%
  kable(format = "html", escape = F) %>%
    kable_styling(bootstrap_options = "striped", full_width = F, 
                  position = "left")
```


### <b>Date Range - Future Bookings</b>

```{r future_bookings_date_range}
clients_query("date_range_future_bookings") %>%
  kable(format = "html", escape = F) %>%
    kable_styling(bootstrap_options = "striped", full_width = F, 
                  position = "left")
```


Row
-------------------------------------------------------------------------------

### <b>Total Clients (in records)</b>

```{r total_clients}
flexdashboard::valueBox(clients_query("total_clients_in_records"),
                        icon = "fa-group")
```


### <b>Total Walk-ins (on receipts)</b>

```{r total_walkins}
flexdashboard::valueBox(clients_query("total_walkins_on_receipts"),
                        icon = "fa-group")
```


Row
-------------------------------------------------------------------------------

### <b>Clients (on records, on receipts, excludes walk-ins)</b>

```{r clients_on_receipts}
flexdashboard::valueBox(clients_query("total_clients_on_receipts_excl_walkins"),
                        icon = "fa-group")
```


### <b>Repeat Clients (> 1 visit, on receipts, excludes walk-ins)</b>

```{r repeat_clients}
flexdashboard::valueBox(clients_query("total_repeat_clients_on_receipts_excl_walkins"),
                        icon = "fa-group")
```


### <b>One-time Clients (on-receipts, excludes walk-ins)</b>

```{r onetime_clients}
flexdashboard::valueBox(clients_query("total_onetime_clients_on_receipts_excl_walkins"),
                        icon = "fa-group")
```


Row
-------------------------------------------------------------------------------

### <b>10 Most Frequent Clients (excludes walk-ins) (scrollable)</b>

```{r frequent_clients_table}
clients_query("most_freq_clients_excl_walkins") %>%
  datatable(filter = "top",
            extensions = "Scroller",
            options = list(autoWidth = T,
                           deferRender = T,
                           scrollY = 370,
                           scroller = T,
                           dom = "frtip",
                           searchHighlight = T,
                           columnDefs = list(list(className = "dt-center",
                                                  targets = "_all"))
                               )
                )
```


Row
-------------------------------------------------------------------------------

### <b>Clients w/ Most Cancellations</b>

```{r most_cancellations}
clients_query("clients_most_cancellations")
```

Staff {data-navmenu="Dashboards"}
===============================================================================

```{r source_staff_queries}
source("R_scripts/staff_queries.R")
```

Row
-------------------------------------------------------------------------------

### <b>Date Range - Receipts</b>

```{r receipts_date_range3}
sales_query("date_range_receipts") %>%
  kable(format = "html", escape = F) %>%
    kable_styling(bootstrap_options = "striped", full_width = F,
                  position = "left")
```

Row
-------------------------------------------------------------------------------

### <b>Earnings by Staff</b>

```{r earnings_by_staff}
staff_query("earnings_by_staff")
```


Row
-------------------------------------------------------------------------------

### <b>Appointments by Staff (excludes Walk-Ins)</b>

```{r appointments_by_staff}
staff_query("appointments_by_staff")
```


Row
-------------------------------------------------------------------------------

### <b>Cancellations by Staff</b>

```{r cancellations_by_staff}
staff_query("cancellations_by_staff")
```

Row
-------------------------------------------------------------------------------

### <b>No-Shows by Staff</b>

```{r noshows_by_staff}
staff_query("noshows_by_staff")
```


Walk-Ins Report {data-navmenu="Reports"}
===============================================================================

### <b>Walk-Ins Report (scrollable)</b>

```{r walkins_report}
source("R_scripts/WalkIns_report.R")

walkins_query("walkins_report") %>%
  datatable(filter = "top",
            extensions = "Scroller",
            options = list(autoWidth = T,
                           deferRender = T,
                           scrollY = 370,
                           scroller = T,
                           dom = "frtip",
                           searchHighlight = T,
                           columnDefs = list(list(className = "dt-center",
                                                  targets = "_all"))
                               )
                )
```

Cancellations Report {data-navmenu="Reports"}
===============================================================================

### <b>Cancellations Report (scrollable)</b>

```{r cancellations_report}
source("R_scripts/cancellation_report.R")

cancellations_query("cancellations_report") %>%
  datatable(filter = "top",
            extensions = "Scroller",
            options = list(autoWidth = T,
                           deferRender = T,
                           scrollY = 740,
                           scroller = T,
                           dom = "frtip",
                           searchHighlight = T,
                           columnDefs = list(list(className = "dt-center",
                                                  targets = "_all"))
                               )
                )
```

No-Show Report {data-navmenu="Reports"}
===============================================================================

### <b>No-Show Report (scrollable)</b>

```{r no_show_report}
source("R_scripts/no_show_report.R")

noshow_query("noshow_report") %>%
  datatable(filter = "top",
            extensions = "Scroller",
            options = list(autoWidth = T,
                           deferRender = T,
                           scrollY = 740,
                           scroller = T,
                           dom = "frtip",
                           searchHighlight = T,
                           columnDefs = list(list(className = "dt-center",
                                                  targets = "_all"))
                               )
                )
```

Price Differences Report {data-navmenu="Reports"}
===============================================================================

### <b>Price Differences Report (scrollable)</b>

```{r price_diff_report}
source("R_scripts/price_diff_report.R")

price_diff_query("price_diff_report") %>%
  datatable(filter = "top",
            extensions = "Scroller",
            options = list(autoWidth = T,
                           deferRender = T,
                           scrollY = 740,
                           scroller = T,
                           dom = "frtip",
                           searchHighlight = T,
                           columnDefs = list(list(className = "dt-center",
                                                  targets = "_all"))
                               )
                )
```
